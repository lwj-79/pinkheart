<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>跳动的心</title>
<style>
html, body {
  height: 100%;
}
body {
  margin: 0;
  display: grid;
  place-items: center;
  background: radial-gradient(1200px 600px at 50% 30%, #ffe5e9 0%, #ffd6dc 35%, #f8b8c2 60%, #f59fb0 100%);
}
.scene {
  position: relative;
  display: grid;
  place-items: center;
  gap: 24px;
}
.heart-neon {
  width: 240px;
  height: 240px;
  animation: beat 900ms infinite cubic-bezier(.26,.08,.25,1);
  filter: drop-shadow(0 0 10px #ff4d6d) drop-shadow(0 0 22px #ff4d6d);
}
.fireworks {
  position: absolute;
  inset: -40px;
  pointer-events: none;
  z-index: 2;
}
.fw {
  position: absolute;
  width: 13px;
  height: 13px;
  border-radius: 50%;
  background: radial-gradient(circle, #fff 0%, rgba(255,255,255,0.2) 60%, rgba(255,255,255,0) 70%);
  animation: explode 1600ms ease-out infinite;
  filter: drop-shadow(0 0 10px rgba(255,255,255,0.55));
}
.petals {
  position: fixed;
  inset: 0;
  overflow: hidden;
  pointer-events: none;
  z-index: 1;
}
.audio { display: none; }
.petal {
  position: absolute;
  top: 0;
  left: 0;
  width: calc(12px * var(--size, 1));
  height: calc(18px * var(--size, 1));
  opacity: 0;
  filter: blur(var(--blur, 0.6px)) drop-shadow(0 2px 2px rgba(0,0,0,0.25));
  will-change: transform, opacity;
}
.petal.landed{
  opacity: .82;
  transition: transform .5s ease, opacity .5s ease;
}
.petal svg {
  width: 100%;
  height: 100%;
  display: block;
}
@keyframes beat {
  0%   { transform: scale(1); }
  20%  { transform: scale(1.12); }
  35%  { transform: scale(0.98); }
  55%  { transform: scale(1.15); }
  75%  { transform: scale(1.02); }
  100% { transform: scale(1); }
}
@keyframes explode {
  0%   { transform: scale(0.5); opacity: 0; }
  18%  { transform: scale(0.9); opacity: 1; }
  60%  { transform: scale(1.6); opacity: 0.85; }
  100% { transform: scale(2.0); opacity: 0; }
}
@keyframes sway {
  0%   { transform: rotate(-10deg) }
  50%  { transform: rotate(10deg) }
  100% { transform: rotate(-10deg) }
}
</style>
</head>
<body>
<div class="scene">
  <svg class="heart-neon" viewBox="0 0 120 100" aria-label="heart" role="img">
    <defs>
      <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
        <stop offset="0" stop-color="#ff4d6d"/>
        <stop offset="1" stop-color="#e03153"/>
      </linearGradient>
      <filter id="glow">
        <feGaussianBlur stdDeviation="3" result="b"/>
        <feMerge>
          <feMergeNode in="b"/>
          <feMergeNode in="b"/>
          <feMergeNode in="b"/>
        </feMerge>
      </filter>
    </defs>
    <g transform="translate(50,0) scale(1.20,1) translate(-50,0)">
      <path d="M73.75 8
             C66.23 8 59.79 11.62 56 17.50
             C52.21 11.62 45.77 8 38.25 8
             C26.56 8 17 17.58 17 29.31
             C17 55.00 56 88 56 88
             C56 88 95 55.11 95 29.31
             C95 17.58 85.44 8 73.75 8 Z"
            fill="none" stroke="url(#g)" stroke-width="8"/>
      <path d="M73.75 8
             C66.23 8 59.79 11.62 56 17.50
             C52.21 11.62 45.77 8 38.25 8
             C26.56 8 17 17.58 17 29.31
             C17 55.00 56 88 56 88
             C56 88 95 55.11 95 29.31
             C95 17.58 85.44 8 73.75 8 Z"
            fill="none" stroke="url(#g)" stroke-width="8" filter="url(#glow)"/>
    </g>
  </svg>
  <div class="fireworks">
    <div class="fw"></div>
    <div class="fw"></div>
    <div class="fw"></div>
    <div class="fw"></div>
    <div class="fw"></div>
    <div class="fw"></div>
  </div>
</div>
<div class="petals" aria-hidden="true"></div>
<div class="audio"><audio id="bgm" src="audio/bg.mp3" autoplay playsinline></audio></div>
<script>
const fwContainer=document.querySelector('.fireworks');
const heartEl=document.querySelector('.heart-neon');
function rf(min,max){return Math.random()*(max-min)+min}
function warmColor(){
  const isWarm=Math.random()<0.65;
  const h=isWarm?rf(0,50):rf(190,240);
  return `radial-gradient(circle, #fff 0%, hsla(${h},85%,70%,0.55) 60%, hsla(${h},85%,70%,0) 72%)`;
}
function placeAroundHeart(){
  const fwRect=fwContainer.getBoundingClientRect();
  const hr=heartEl.getBoundingClientRect();
  const cx=hr.left+hr.width/2 - fwRect.left;
  const cy=hr.top +hr.height/2 - fwRect.top;
  const R=hr.width*0.42;
  const ring=76;
  return function(el, a, d){
    const x=cx + Math.cos(a)*d;
    const y=cy + Math.sin(a)*d;
    const r=(parseFloat(el.style.width)||20)/2;
    el.style.left=(x-r)+'px';
    el.style.top=(y-r)+'px';
  };
}
function spawnFWBatch(){
  if(!fwContainer||!heartEl) return;
  fwContainer.innerHTML='';
  const count=Math.floor(rf(1,6));
  const place=placeAroundHeart();
  const angles=[];
  const minSep=0.8;
  while(angles.length<count && angles.length<8){
    const a=rf(0,Math.PI*2);
    if(angles.every(t=>Math.abs(Math.atan2(Math.sin(a-t), Math.cos(a-t)))>minSep)){
      angles.push(a);
    }
  }
  for(let i=0;i<count;i++){
    const el=document.createElement('div');
    el.className='fw';
    const size=rf(8,13);
    el.style.width=size+'px';
    el.style.height=size+'px';
    el.style.background=warmColor();
    const hr=heartEl.getBoundingClientRect();
    const d= rf(0, hr.width*0.42 + 57);
    const a=angles[i]!==undefined?angles[i]:rf(0,Math.PI*2);
    place(el,a,d);
    const dur=Math.floor(rf(1300,1800));
    el.style.animation=`explode ${dur}ms linear 1`;
    fwContainer.appendChild(el);
    el.addEventListener('animationend', ()=>el.remove());
  }
}
setInterval(spawnFWBatch, 1600);
spawnFWBatch();
const c=document.querySelector('.petals');
if(c){ c.innerHTML=''; }
function r(a,b){return Math.random()*(b-a)+a}
function bez(p0,p1,p2,p3,t){
  const it=1-t;
  const x = it**3*p0.x + 3*it**2*t*p1.x + 3*it*t**2*p2.x + t**3*p3.x;
  const y = it**3*p0.y + 3*it**2*t*p1.y + 3*it*t**2*p2.y + t**3*p3.y;
  const dx = 3*it**2*(p1.x-p0.x) + 6*it*t*(p2.x-p1.x) + 3*t**2*(p3.x-p2.x);
  const dy = 3*it**2*(p1.y-p0.y) + 6*it*t*(p2.y-p1.y) + 3*t**2*(p3.y-p2.y);
  const ang = Math.atan2(dy, dx);
  return { x, y, ang };
}
function spawn(){
  if(!c) return;
  if(c.querySelectorAll('.petal:not(.landed)').length>=10) return;
  const gid = 'g'+Math.random().toString(36).slice(2);
  const wrap = document.createElement('div');
  wrap.className = 'petal';
  wrap.style.setProperty('--size', r(1,3).toFixed(2));
  wrap.style.setProperty('--blur', r(0.6,1.2).toFixed(2)+'px');
  const w = window.innerWidth, h = window.innerHeight;
  const x0 = r(0.05,0.95)*w;
  const x1 = x0 + r(-0.25, 0.25)*w;
  const x2 = x0 + r(-0.45, 0.45)*w;
  const x3 = x0 + r(-0.60, 0.60)*w;
  const y0 = -60;
  const y1 = r(0.25,0.40)*h;
  const y2 = r(0.60,0.80)*h;
  const y3 = h + 80;
  const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.setAttribute('viewBox','0 0 60 60');
  svg.innerHTML = `
    <defs>
      <radialGradient id="${gid}" cx="45%" cy="50%" r="70%">
        <stop offset="0%" stop-color="#ff8a9a"/>
        <stop offset="50%" stop-color="#e03153"/>
        <stop offset="100%" stop-color="#b51b3a"/>
      </radialGradient>
    </defs>
    <path d="M18 10
             C12 8, 6 18, 10 30
             C12 38, 22 44, 32 42
             C46 39, 54 30, 50 20
             C47 13, 36 10, 28 12
             C24 11, 21 11, 18 10 Z"
          fill="url(#${gid})"/>
    <path d="M34 14
             C39 15, 42 18, 44 22"
          fill="none" stroke="rgba(255,255,255,0.35)" stroke-width="2" stroke-linecap="round"/>
    <path d="M28 18
             C36 20, 40 28, 30 34"
          fill="none" stroke="rgba(255,255,255,0.25)" stroke-width="6" stroke-linecap="round" opacity="0.6"/>
  `;
  wrap.appendChild(svg);
  c.appendChild(wrap);
  const p0={x:x0,y:y0}, p1={x:x1,y:y1}, p2={x:x2,y:y2}, p3={x:x3,y:y3};
  const dur = r(20,28)*1000;
  const sway = r(-10,10);
  const t0 = performance.now();
  const stopY = h - (96 / 2.54) * r(2,5);
  let landed = false;
  function step(now){
    if(landed) return;
    const t = Math.min(1, (now - t0) / dur);
    const {x,y,ang} = bez(p0,p1,p2,p3,t);
    const fade = t<0.08 ? t/0.08 : (t>0.92 ? (1-(t-0.92)/0.08) : 1);
    wrap.style.opacity = String(fade);
    wrap.style.transform = `translate(${x}px, ${y}px) rotate(${(ang*180/Math.PI)+sway*Math.sin(t*6)}deg)`;
    if(y >= stopY){
      landed = true;
      wrap.classList.add('landed');
      wrap.style.opacity = '0.82';
      wrap.style.transform = `translate(${x}px, ${stopY}px) rotate(${(ang*180/Math.PI)}deg)`;
      if(c && c.querySelectorAll('.petal.landed').length > 140){
        const old = c.querySelector('.petal.landed');
        if(old){ old.remove(); }
      }
      return;
    }
    if(t<1){ requestAnimationFrame(step); } else {
      landed = true;
      wrap.classList.add('landed');
      wrap.style.opacity = '0.82';
    }
  }
  requestAnimationFrame(step);
}
function loop(){
  const falling=c?c.querySelectorAll('.petal:not(.landed)').length:0;
  const batch=Math.min(Math.floor(r(2,4)), Math.max(0, 10-falling));
  for(let i=0;i<batch;i++){ spawn() }
  setTimeout(loop, 3000);
}
loop();
</script>
<script>
document.addEventListener('DOMContentLoaded', function(){
  const bgm = document.getElementById('bgm');
  if(!bgm) return;
  bgm.loop = true;
  bgm.preload = 'auto';
  bgm.volume = 0.85;
  function unlock(){
    bgm.muted = false;
    bgm.volume = 0.85;
    bgm.play().catch(function(){});
    window.removeEventListener('pointerdown', unlock);
    window.removeEventListener('keydown', unlock);
    window.removeEventListener('touchstart', unlock);
  }
  bgm.play().catch(function(){
    bgm.muted = true;
    bgm.play().then(function(){
      bgm.muted = false;
      let v = 0;
      bgm.volume = v;
      function fade(){
        v = Math.min(0.85, v + 0.05);
        bgm.volume = v;
        if(v < 0.85){ setTimeout(fade, 120); }
      }
      fade();
    }).catch(function(){
      window.addEventListener('pointerdown', unlock, { once: true });
      window.addEventListener('keydown', unlock, { once: true });
      window.addEventListener('touchstart', unlock, { once: true });
    });
  });
});
</script>
</body>
</html>
